- name: Healthcheck
  class: healthcheck
  id: [name]
  schema:
    - created_at: datetime = now()
    - description: string? #max(500)
    - is_active: bool = true
    - interval_seconds: int = 60 #min(1)
    - name: string #required #unique #max(200)
    - timeout_seconds: int = 30 #min(1)
    - type: route | response_time | job_execution | event_rate | custom = route
    - updated_at: datetime = now()

- name: Healthcheck Route
  class: healthcheck_route
  id: [healthcheck_id]
  schema:
    - expected_status_codes: string = 200 #max(100)
    - expected_body_contains: string? #max(1000)
    - headers: string?
    - healthcheck_id: id #required -> Healthcheck.id
    - method: GET | POST | PUT | PATCH | DELETE | HEAD | OPTIONS = GET
    - url: string #required #url #max(2000)

- name: Healthcheck Response Time
  class: healthcheck_response_time
  id: [healthcheck_id]
  schema:
    - healthcheck_id: id #required -> Healthcheck.id
    - route_id: id? -> Route.id
    - threshold_ms: int = 1000 #min(1)
    - url: string? #url #max(2000)

- name: Healthcheck Job Execution
  class: healthcheck_job_execution
  id: [healthcheck_id]
  schema:
    - healthcheck_id: id #required -> Healthcheck.id
    - job_name: string #required #max(200)
    - max_duration_seconds: int? #min(1)
    - max_failures_percent: decimal? #min(0) #max(100)
    - queue: string? #max(100)

- name: Healthcheck Event Rate
  class: healthcheck_event_rate
  id: [healthcheck_id]
  schema:
    - comparison: gt | gte | lt | lte | eq | neq = gte
    - event_type: string #required #max(100)
    - healthcheck_id: id #required -> Healthcheck.id
    - source: string? #max(200)
    - threshold: decimal #required #min(0)
    - window: second | minute | hour | day = minute

- name: Healthcheck Custom
  class: healthcheck_custom
  id: [healthcheck_id]
  schema:
    - healthcheck_id: id #required -> Healthcheck.id
    - metric_id: id? -> Metric.id
    - query: string #required #max(5000)
    - success_condition: string #required #max(1000)

- name: Healthcheck Result
  class: healthcheck_result
  id: [healthcheck_id, checked_at]
  schema:
    - checked_at: datetime = now()
    - duration_ms: int? #min(0)
    - error_message: string? #max(2000)
    - healthcheck_id: id #required -> Healthcheck.id
    - metadata: string?
    - status: healthy | degraded | unhealthy = healthy

- name: Healthcheck Alert
  class: healthcheck_alert
  id: [healthcheck_id]
  schema:
    - consecutive_failures: int = 3 #min(1)
    - cooldown_seconds: int = 300 #min(0)
    - created_at: datetime = now()
    - healthcheck_id: id #required -> Healthcheck.id
    - is_active: bool = true
    - last_triggered_at: datetime?
    - notification_channel: string? #max(100)
    - updated_at: datetime = now()
