- action: create_repository
  inputs:
    encryption_type: aes256 | kms
    image_tag_mutability: mutable | immutable = mutable
    kms_key: string
    region: string
    repository_name: string
    scan_on_push: boolean = false
    tags: ecr_tags
  outputs:
    registry_id: string
    repository_arn: string
    repository_uri: string
    success: boolean

- action: delete_repository
  inputs:
    force: boolean = false
    region: string
    repository_name: string
  outputs:
    success: boolean

- action: describe_repositories
  inputs:
    region: string
    repository_names: list[string]
  outputs:
    repositories: list[ecr_repository]

- action: list_images
  inputs:
    filter: image_filter
    max_results: int = 100
    region: string
    repository_name: string
  outputs:
    image_ids: list[image_id]
    next_token: string

- action: describe_images
  inputs:
    image_ids: list[image_id]
    region: string
    repository_name: string
  outputs:
    image_details: list[ecr_image_detail]

- action: put_image
  inputs:
    image_manifest: string
    image_tag: string
    region: string
    repository_name: string
  outputs:
    image: ecr_image
    success: boolean

- action: batch_delete_image
  inputs:
    image_ids: list[image_id]
    region: string
    repository_name: string
  outputs:
    failures: list[image_failure]
    image_ids: list[image_id]
    success: boolean

- action: get_auth_token
  inputs:
    region: string
    registry_ids: list[string]
  outputs:
    authorization_token: string
    expires_at: date
    proxy_endpoint: string
    success: boolean

- action: get_download_url
  inputs:
    image_digest: string
    region: string
    repository_name: string
  outputs:
    download_url: string
    success: boolean

- action: tag_image
  inputs:
    image_digest: string
    image_tag: string
    region: string
    repository_name: string
  outputs:
    success: boolean

- action: set_repository_policy
  inputs:
    force: boolean = false
    policy_text: string
    region: string
    repository_name: string
  outputs:
    policy_text: string
    registry_id: string
    repository_name: string
    success: boolean

- action: get_repository_policy
  inputs:
    region: string
    repository_name: string
  outputs:
    policy_text: string
    registry_id: string
    repository_name: string

- action: delete_repository_policy
  inputs:
    region: string
    repository_name: string
  outputs:
    success: boolean

- action: start_image_scan
  inputs:
    image_id: image_id
    region: string
    repository_name: string
  outputs:
    image_id: image_id
    scan_status: string
    success: boolean

- action: describe_scan_findings
  inputs:
    image_id: image_id
    max_results: int = 100
    region: string
    repository_name: string
  outputs:
    findings: list[image_scan_finding]
    image_scan_status: image_scan_status
    next_token: string

- action: put_lifecycle_policy
  inputs:
    lifecycle_policy_text: string
    region: string
    repository_name: string
  outputs:
    lifecycle_policy_text: string
    registry_id: string
    repository_name: string
    success: boolean

- action: get_lifecycle_policy
  inputs:
    region: string
    repository_name: string
  outputs:
    last_evaluated_at: date
    lifecycle_policy_text: string
    registry_id: string
    repository_name: string

- object: repository
  id: [account_id, repository_name]
  schema:
    - account_id: string #max(20)
    - created_at: date = now()
    - encryption_type: aes256 | kms = aes256
    - image_tag_mutability: mutable | immutable = mutable
    - kms_key: string? #max(255)
    - region: string? #max(50)
    - registry_id: string? #max(20)
    - repository_arn: string? #max(255)
    - repository_name: string #unique #max(255)
    - repository_uri: string? #max(500)
    - scan_on_push: boolean = false
    - tags: string? # json
    - updated_at: date = now()

- object: image
  id: [repository_id, image_digest]
  schema:
    - created_at: date = now()
    - image_digest: string #max(255)
    - image_manifest_media_type: string? #max(100)
    - image_pushed_at: date?
    - image_size_bytes: int? #min(0)
    - image_tags: string? # json list
    - last_scan_at: date?
    - repository_id: id -> aws_ecr_repository.id
    - scan_status: in_progress | complete | failed | unsupported = in_progress
    - vulnerability_count: int = 0 #min(0)

- object: repository_policy
  id: [repository_id]
  schema:
    - created_at: date = now()
    - policy_text: string
    - repository_id: id -> aws_ecr_repository.id
    - updated_at: date = now()

- object: lifecycle_policy
  id: [repository_id]
  schema:
    - created_at: date = now()
    - last_evaluated_at: date?
    - lifecycle_policy_text: string
    - repository_id: id -> aws_ecr_repository.id
    - updated_at: date = now()

- object: image_scan_finding
  id: [image_id, name, uri]
  schema:
    - description: string? #max(1000)
    - image_id: id -> aws_ecr_image.id

    - name: string #max(255)
    - severity: informational | low | medium | high | critical | undefined = undefined
    - uri: string? #url