- action: send_apns
  inputs:
    alert: string
    badge: int
    body: string
    category: string
    collapse_id: string
    custom_data: map[string, any]
    device_token: string
    expiration: int
    priority: 5 | 10 = 10
    sound: string
    subtitle: string
    thread_id: string
    title: string
    topic: string
  outputs:
    apns_id: string
    error: string
    success: boolean

- action: send_web_push
  inputs:
    actions: list[push_action]
    badge: string
    body: string
    data: map[string, any]
    dir: auto | ltr | rtl = auto
    icon: string
    image: string
    lang: string
    renotify: boolean = false
    require_intermethod: boolean = false
    silent: boolean = false
    subscription: push_subscription
    tag: string
    timestamp: int
    title: string
    vibrate: list[integer]
  outputs:
    error: string
    success: boolean

- action: send_fcm
  inputs:
    body: string
    channel_id: string
    click_method: string
    collapse_key: string
    color: string
    data: map[string, any]
    icon: string
    image: string
    priority: min | low | default | high | max = default
    registration_token: string
    sound: string
    tag: string
    time_to_live: int
    title: string
  outputs:
    error: string
    message_id: string
    success: boolean

- action: send_multicast_push
  inputs:
    body: string
    data: map[string, any]
    platform: apns | web | fcm
    title: string
    tokens: list[string]
  outputs:
    failed: int
    failures: list[push_failure]
    successful: int
    total: int

- action: send_topic_push
  inputs:
    body: string
    data: map[string, any]
    platform: apns | web | fcm
    title: string
    topic: string
  outputs:
    message_id: string
    success: boolean

- action: subscribe_to_topic
  inputs:
    platform: apns | web | fcm
    tokens: list[string]
    topic: string
  outputs:
    failed_tokens: list[string]
    success: boolean

- action: unsubscribe_from_topic
  inputs:
    platform: apns | web | fcm
    tokens: list[string]
    topic: string
  outputs:
    failed_tokens: list[string]
    success: boolean

- action: validate_push_token
  inputs:
    platform: apns | web | fcm
    token: string
  outputs:
    error: string
    valid: boolean

- object: notification
  class:
    title: string
    body: string
    platform: string
    token: string
    data: map[string, any]
    badge: int
    sound: string

- object: action
  class:
    method: string
    title: string
    icon: string

- object: subscription
  class:
    endpoint: string
    keys: push_subscription_keys

- object: subscription_keys
  class:
    p256dh: string
    auth: string

- object: failure
  class:
    token: string
    error: string

- object: device
  id: [user_id, device_token]
  schema:
    - created_at: date = now()
    - device_token: string #max(500)
    - is_active: boolean = true
    - platform: apns | web | fcm = fcm
    - updated_at: date = now()
    - user_agent: string? #max(500)
    - user_id: id -> user.id

- object: topic
  id: [name]
  schema:
    - created_at: date = now()
    - description: string? #max(500)
    - is_active: boolean = true

    - name: string #unique #max(200)
    - platform: apns | web | fcm = fcm

- object: topic_subscription
  id: [topic_id, device_id]
  schema:
    - device_id: id -> push_device.id
    - subscribed_at: date = now()
    - topic_id: id -> push_topic.id

- object: notification_log
  id: [device_id, sent_at]
  schema:
    - body: string #max(1000)
    - device_id: id? -> push_device.id
    - error_message: string? #max(1000)
    - message_id: string? #max(200)
    - platform: apns | web | fcm = fcm
    - sent_at: date = now()
    - status: pending | sent | delivered | failed = pending
    - title: string #max(200)
    - topic_id: id? -> push_topic.id

- object: notification
  schema:
    - title: string
    - body: string
    - platform: string
    - token: string
    - data: map[string, any]
    - badge: int
    - sound: string

- object: action
  schema:
    - method: string
    - title: string
    - icon: string

- object: subscription
  schema:
    - endpoint: string
    - keys: push_subscription_keys

- object: subscription_keys
  schema:
    - p256dh: string
    - auth: string

- object: failure
  schema:
    - token: string
    - error: string
