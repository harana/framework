- action: client/get
  inputs:
    - name: url
      type: string
      required: true
      description: the url to send the get request to
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
    - name: query_params
      type: hash
      required: false
      description: optional query parameters to append to the url
  outputs:
    - get_output

- action: client/post
  inputs:
    - name: url
      type: string
      required: true
      description: the url to send the post request to
    - name: body
      type: string
      required: false
      description: the request body content
    - name: content_type
      type: string
      required: false
      description: content type header (default application/json)
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: query_params
      type: hash
      required: false
      description: optional query parameters to append to the url
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
  outputs:
    - post_output

- action: client/put
  inputs:
    - name: url
      type: string
      required: true
      description: the url to send the put request to
    - name: body
      type: string
      required: false
      description: the request body content
    - name: content_type
      type: string
      required: false
      description: content type header (default application/json)
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: query_params
      type: hash
      required: false
      description: optional query parameters to append to the url
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
  outputs:
    - put_output

- action: client/patch
  inputs:
    - name: url
      type: string
      required: true
      description: the url to send the patch request to
    - name: body
      type: string
      required: false
      description: the request body content
    - name: content_type
      type: string
      required: false
      description: content type header (default application/json)
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: query_params
      type: hash
      required: false
      description: optional query parameters to append to the url
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
  outputs:
    - patch_output

- action: client/delete
  inputs:
    - name: url
      type: string
      required: true
      description: the url to send the delete request to
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: query_params
      type: hash
      required: false
      description: optional query parameters to append to the url
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
  outputs:
    - delete_output

- action: client/download
  inputs:
    - name: url
      type: string
      required: true
      description: the url to download the file from
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 300)
  outputs:
    - download_output

- action: client/upload
  inputs:
    - name: file
      type: bytes
      required: true
      description: the file content to upload
    - name: filename
      type: string
      required: true
      description: the filename for the uploaded file
    - name: url
      type: string
      required: true
      description: the url to upload the file to
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 300)
  outputs:
    - upload_output

- action: client/graphql_query
  inputs:
    - name: url
      type: string
      required: true
      description: the graph_ql endpoint url
    - name: query
      type: string
      required: true
      description: the graph_ql query string
    - name: headers
      type: hash
      required: false
      description: optional http headers to include with the request
    - name: variables
      type: hash
      required: false
      description: optional graph_ql variables
    - name: timeout
      type: integer
      required: false
      description: request timeout in seconds (default 30)
  outputs:
    - graphql_query_output

# Output Types

- class: get_output
  fields:
    - name: body
      type: string
      description: response body content
    - name: headers
      type: hash
      description: response headers
    - name: status_code
      type: integer
      description: http status code

- class: post_output
  fields:
    - name: body
      type: string
      description: response body content
    - name: headers
      type: hash
      description: response headers
    - name: status_code
      type: integer
      description: http status code

- class: put_output
  fields:
    - name: body
      type: string
      description: response body content
    - name: headers
      type: hash
      description: response headers
    - name: status_code
      type: integer
      description: http status code

- class: patch_output
  fields:
    - name: body
      type: string
      description: response body content
    - name: headers
      type: hash
      description: response headers
    - name: status_code
      type: integer
      description: http status code

- class: delete_output
  fields:
    - name: body
      type: string
      description: response body content
    - name: headers
      type: hash
      description: response headers
    - name: status_code
      type: integer
      description: http status code

- class: download_output
  fields:
    - name: content
      type: bytes
      description: downloaded file content
    - name: content_type
      type: string
      description: content type of the downloaded file
    - name: size
      type: integer
      description: size of the downloaded content in bytes

- class: upload_output
  fields:
    - name: body
      type: string
      description: upload response body
    - name: status_code
      type: integer
      description: http status code

- class: graphql_query_output
  fields:
    - name: data
      type: any
      description: graph_ql response data
    - name: errors
      type: array[graphql_error]
      description: graph_ql errors if any

- class: graphql_error
  fields:
    - name: message
      type: string
      description: error message
    - name: path
      type: array[string]
      description: path to the field that caused the error
    - name: locations
      type: array[graphql_error_location]
      description: source locations related to the error

- class: graphql_error_location
  fields:
    - name: line
      type: integer
      description: line number in the query
    - name: column
      type: integer
      description: column number in the query

- object: connection
  schema:
    - client_type: memcache | memgraph | mongodb | rocksdb | meilisearch | tantivy | http | aws | redis | postgres | mysql = http
    - connection_retry_attempts: int = 3 #min(0)
    - connection_retry_delay_ms: int = 1000 #min(0)
    - connection_string: string? #max(1000)
    - created_at: date = now()
    - database: string? #max(100)
    - host: string #max(255)
    - is_active: boolean = true
    - max_connections: int = 10 #min(1)
    - metadata: string? # json for provider-specific config
    - min_connections: int = 1 #min(1)
    - password: string? #max(255)
    - port: int #min(1) #max(65535)
    - ssl_cert_path: string? #max(500)
    - timeout_seconds: int = 30 #min(1)
    - updated_at: date = now()
    - use_ssl: boolean = false
    - username: string? #max(255)

- object: pool
  schema:
    - active_connections: int = 0 #min(0)
    - connection_id: id -> client_connection.id
    - created_at: date = now()
    - idle_connections: int = 0 #min(0)
    - idle_timeout_seconds: int = 300 #min(1)
    - is_healthy: boolean = true
    - max_wait_time_ms: int = 5000 #min(0)
    - pool_size: int #min(1) #max(1000)
    - updated_at: date = now()
    - wait_queue_size: int = 0 #min(0)

- object: query
  id: [connection_id, executed_at, query_hash]
  schema:
    - bytes_returned: int? #min(0)
    - connection_id: id -> client_connection.id
    - duration_ms: int? #min(0)
    - error_message: string? #max(1000)
    - executed_at: date = now()
    - executed_by: id? -> user.id
    - parameters: string? # json parameters
    - query_hash: string? #max(128)
    - query_text: string? #max(10000)
    - query_type: select | insert | update | delete | execute | get | set | delete_key | search | aggregate = select
    - rows_affected: int? #min(0)
    - status: success | failed | timeout | cancelled = success

- object: health_check
  id: [connection_id, checked_at]
  schema:
    - checked_at: date = now()
    - connection_id: id -> client_connection.id
    - error_message: string? #max(1000)
    - is_healthy: boolean = true
    - metadata: string? # json health metrics
    - response_time_ms: int? #min(0)

- object: config
  id: [connection_id, key]
  schema:
    - connection_id: id -> client_connection.id
    - created_at: date = now()
    - description: string? #max(500)
    - is_encrypted: boolean = false
    - is_required: boolean = false
    - key: string #max(255)
    - updated_at: date = now()
    - value: string

- object: get_output
  schema:
    - body: string
    - headers: map[string, any]
    - status_code: int

- object: post_output
  schema:
    - body: string
    - headers: map[string, any]
    - status_code: int

- object: put_output
  schema:
    - body: string
    - headers: map[string, any]
    - status_code: int

- object: patch_output
  schema:
    - body: string
    - headers: map[string, any]
    - status_code: int

- object: delete_output
  schema:
    - body: string
    - headers: map[string, any]
    - status_code: int

- object: download_output
  schema:
    - content: bytes
    - content_type: string
    - size: int

- object: upload_output
  schema:
    - body: string
    - status_code: int

- object: graphql_query_output
  schema:
    - data: any
    - errors: list[graphql_error]

- object: graphql_error
  schema:
    - message: string
    - path: list[string]
    - locations: list[graphql_error_location]

- object: graphql_error_location
  schema:
    - line: int
    - column: int
