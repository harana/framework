- name: file
  id: [full_path]
  schema:
    - created_at: date = now()
    - path: string #required #max(2000)
    - full_path: string #required #unique #max(4000)
    - parent_id: id? -> file.id
    - type: file | directory = file
    - extension: string? #max(50)
    - mime_type: string? #max(100)
    - size: int = 0 #min(0)
    - content_hash: string? #max(128) # md5, sha256, etc.
    - is_hidden: boolean = false
    - is_system: boolean = false
    - is_readonly: boolean = false
    - is_archived: boolean = false
    - permissions: string? #max(20)
    - owner: string? #max(255)
    - group: string? #max(255)
    - blob_id: id? -> blob_object.id
    - created_by: id? -> user.id
    - modified_at: date?
    - modified_by: id? -> user.id
    - accessed_at: date?
    - updated_at: date = now()

- name: file_version
  id: [file_id, version_number]
  schema:
    - file_id: id #required -> file.id
    - version_number: int #required #min(1)
    - size: int #required #min(0)
    - content_hash: string #required #max(128)
    - blob_id: id? -> blob_object.id
    - comment: string? #max(500)
    - created_at: date = now()
    - created_by: id? -> user.id
    - is_current: boolean = true

- name: file_metadata
  id: [file_id, key]
  schema:
    - file_id: id #required -> file.id
    - key: string #required #max(255)
    - value: string #required
    - value_type: string | int | float | bool | date | json = string
    - source: user | system | extracted | indexed = user
    - created_at: date = now()
    - updated_at: date = now()

- name: file_tag
  schema:
    - color: string? #max(7) # hex color
    - description: string? #max(500)
    - created_at: date = now()
    - created_by: id? -> user.id

- name: file_tag_association
  id: [file_id, tag_id]
  schema:
    - file_id: id #required -> file.id
    - tag_id: id #required -> file_tag.id
    - created_at: date = now()
    - created_by: id? -> user.id

- name: file_share
  id: [share_token]
  schema:
    - file_id: id #required -> file.id
    - shared_by: id #required -> user.id
    - shared_with: id? -> user.id # null = public share
    - share_token: string #required #unique #max(255)
    - permissions: read | write | delete = read
    - password: string? #max(255)
    - download_limit: int? #min(1)
    - download_count: int = 0 #min(0)
    - expires_at: date?
    - is_active: boolean = true
    - created_at: date = now()
    - accessed_at: date?

- name: file_operation
  id: [file_id, operation, performed_at]
  schema:
    - file_id: id #required -> file.id
    - operation: create | read | update | delete | copy | move | rename | upload | download | compress | decompress | convert = read
    - status: pending | in_progress | completed | failed | cancelled = pending
    - source_path: string? #max(4000)
    - destination_path: string? #max(4000)
    - bytes_processed: int = 0 #min(0)
    - total_bytes: int? #min(0)
    - progress_percent: int = 0 #min(0) #max(100)
    - error_message: string? #max(1000)
    - performed_at: date = now()
    - performed_by: id? -> user.id
    - completed_at: date?

- name: file_format
  id: [format_type]
  schema:
    - format_type: csv | docx | ical | ipynb | json | md | parquet | pbix | pdf | pptx | qif | rtf | txt | vcard | warc | xlsx | yaml | zip = txt
    - encoding: string? #max(50) # e.g., utf-8, ascii
    - page_count: int? #min(0)
    - word_count: int? #min(0)
    - line_count: int? #min(0)
    - column_count: int? #min(0)
    - row_count: int? #min(0)
    - has_macros: boolean = false
    - is_encrypted: boolean = false
    - language: string? #max(10) # i_s_o 639-1 code
    - author: string? #max(255)
    - title: string? #max(500)
    - subject: string? #max(500)
    - keywords: string? #max(1000)
    - created_at: date = now()
    - updated_at: date = now()

- name: file_index
  id: [file_id, index_type]
  schema:
    - file_id: id #required -> file.id
    - index_type: fulltext | metadata | ocr | embedding = fulltext
    - content: string? # indexed content
    - content_vector: string? # j_s_o_n array for embeddings
    - language: string? #max(10)
    - indexed_at: date = now()
    - index_version: string? #max(50)
    - is_current: boolean = true

- name: file_watch
  id: [path, pattern, watch_type]
  schema:
    - path: string #required #max(4000)
    - pattern: string? #max(255) # glob pattern
    - watch_type: create | modify | delete | all = all
    - is_recursive: boolean = true
    - is_active: boolean = true
    - callback_url: string? #url
    - callback_event: string? #max(100)
    - created_at: date = now()
    - created_by: id? -> user.id
    - last_triggered_at: date?

- name: file_crawl
  id: [root_path, started_at]
  schema:
    - root_path: string #required #max(4000)
    - pattern: string? #max(255) # glob pattern
    - exclude_pattern: string? #max(255)
    - max_depth: int? #min(0)
    - max_files: int? #min(1)
    - follow_symlinks: boolean = false
    - status: pending | running | completed | failed | cancelled = pending
    - files_found: int = 0 #min(0)
    - files_processed: int = 0 #min(0)
    - total_size: int = 0 #min(0)
    - error_message: string? #max(1000)
    - started_at: date?
    - completed_at: date?
    - created_at: date = now()
    - created_by: id? -> user.id
